# –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á OJS-–ø–∞—Ä–∏—Ç–µ—Ç–∞

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-04

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: `base.py`, `dev.py`, `prod.py`
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω `django-environ` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω `.env.example` —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è ETL –∏ Django
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (HSTS, CSP) –≤ `prod.py`

### 2. –ú–æ–¥–µ–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚úÖ
- ‚úÖ –î–æ–ø–æ–ª–Ω–µ–Ω–∞ –º–æ–¥–µ–ª—å `Issue` (–¥–æ–±–∞–≤–ª–µ–Ω `slug`, –∏–Ω–¥–µ–∫—Å—ã, `get_absolute_url`)
- ‚úÖ –î–æ–ø–æ–ª–Ω–µ–Ω–∞ –º–æ–¥–µ–ª—å `Article` (–¥–æ–±–∞–≤–ª–µ–Ω `slug`, `section`, –∏–Ω–¥–µ–∫—Å—ã, `get_absolute_url`)
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–æ–¥–µ–ª–∏: `ArticleLocale`, `Keyword`, `ArticleFile` (–≤ `articles/models_extended.py`)
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–æ–¥–µ–ª–∏: `NewsLocale`, `PageLocale`, `Event`, `RawDocument`, `Affiliation` (–≤ `core/models_extended.py`)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Redirect` (–¥–æ–±–∞–≤–ª–µ–Ω `http_status`, —É–ª—É—á—à–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã)

### 3. ETL –ø–∞–∫–µ—Ç ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–∞–∫–µ—Ç `etl/` —Å –º–æ–¥—É–ª—è–º–∏:
  - `util.py` - —É—Ç–∏–ª–∏—Ç—ã (SHA256, JSONL, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è URL)
  - `normalize.py` - –æ—á–∏—Å—Ç–∫–∞ HTML (–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤, —É–¥–∞–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤/—Å—Ç–∏–ª–µ–π)
  - `crawler.py` - –±–∞–∑–æ–≤—ã–π –∫—Ä–∞—É–ª–µ—Ä –¥–ª—è OJS —Å–∞–π—Ç–∞
  - `cli.py` - CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`python -m etl crawl ...`)
  - `__main__.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞

### 4. Management –∫–æ–º–∞–Ω–¥–∞ –∏–º–ø–æ—Ä—Ç–∞ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `articles/management/commands/import_jhd.py`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ JSONL —Ñ–∞–π–ª–∞ –∏–ª–∏ URL
- ‚úÖ –†–µ–∂–∏–º `--dry-run` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å—Ç–∞—Ç–µ–π –∏ –≤—ã–ø—É—Å–∫–æ–≤

### 5. –†–µ–¥–∏—Ä–µ–∫—Ç—ã ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `RedirectMiddleware` –≤ `core/middleware.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω middleware –≤ `MIDDLEWARE` –≤ `settings/base.py`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Redirect` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 301/302
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –≤ `Event`

### 6. Makefile ‚úÖ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `Makefile` —Å –∫–æ–º–∞–Ω–¥–∞–º–∏:
  - `make dev` - –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
  - `make etl` - ETL –∫—Ä–∞—É–ª–∏–Ω–≥
  - `make import` - –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
  - `make test`, `make migrate`, `make deploy`

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ / –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 3. –ü–æ–∏—Å–∫ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã GIN –∏–Ω–¥–µ–∫—Å—ã –≤ –º–æ–¥–µ–ª—è—Ö (–¥–ª—è Postgres)
- ‚úÖ API `/api/search` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Postgres full-text –∏ fallback –Ω–∞ SQLite
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–ø—É—Å–∫–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ slug –≤ URL —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞

### 6. URL, –≤—å—é—Ö–∏, —à–∞–±–ª–æ–Ω—ã ‚úÖ
- ‚úÖ URLs –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ slug (`/articles/<slug>/`)
- ‚úÖ `ArticleDetailView` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ slug –∏ pk
- ‚úÖ `file_download` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `ArticleFile`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- ‚è≥ –®–∞–±–ª–æ–Ω—ã —Å i18n (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞) - —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤
- ‚è≥ OpenGraph/Twitter meta —Ç–µ–≥–∏ - —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤
- ‚è≥ –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ - —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤

### 8. SEO ‚úÖ
- ‚úÖ `sitemap.xml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `core/sitemaps.py` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π slug
- ‚úÖ `robots.txt` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `core/views.py`
- ‚úÖ `ArticleSitemap` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è slug
- ‚è≥ `humans.txt` - –Ω–µ —Å–æ–∑–¥–∞–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 9. –¢–µ—Å—Ç—ã ‚è≥
- ‚è≥ Smoke-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π
- ‚è≥ –¢–µ—Å—Ç—ã –¥–ª—è URLs
- ‚è≥ –¢–µ—Å—Ç—ã –¥–ª—è views (–ø–æ–∏—Å–∫, —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã)
- ‚è≥ –¢–µ—Å—Ç—ã –¥–ª—è ETL

### 10. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚è≥
- ‚è≥ `INSTALL.md` - –Ω–µ —Å–æ–∑–¥–∞–Ω
- ‚è≥ `DEPLOY.md` - –Ω–µ —Å–æ–∑–¥–∞–Ω
- ‚è≥ `ETL.md` - –Ω–µ —Å–æ–∑–¥–∞–Ω
- ‚è≥ `REDIRECTS.md` - –Ω–µ —Å–æ–∑–¥–∞–Ω
- ‚è≥ `BACKUP_RESTORE.md` - –Ω–µ —Å–æ–∑–¥–∞–Ω

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è slug
- ‚úÖ Slug –¥–ª—è –≤—ã–ø—É—Å–∫–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

2. **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å ETL –ø–∞—Ä—Å–µ—Ä—ã:**
   - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `_extract_article()` –∏ `_extract_issue()` –≤ `crawler.py`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ OJS XML —Ñ–æ—Ä–º–∞—Ç–∞ (—Ñ–∞–π–ª `ojs_xml.py`)
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `files.py` –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `mapping.py` –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è old->new URL

3. **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –∏–º–ø–æ—Ä—Ç–∞:**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç —Å—Ç–∞—Ç–µ–π —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è–º–∏
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –≤—ã–ø—É—Å–∫–æ–≤
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –∞–≤—Ç–æ—Ä–æ–≤ –∏ –∞—Ñ—Ñ–∏–ª–∏–∞—Ü–∏–π
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CSV –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–ø—É—Å–∫–∞—Ö

4. **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤—å—é—Ö–∏:**
   - –û–±–Ω–æ–≤–∏—Ç—å `ArticleDetailView` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ slug
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤ `/api/search`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –≤ —à–∞–±–ª–æ–Ω—ã
   - –î–æ–±–∞–≤–∏—Ç—å OpenGraph/Twitter meta —Ç–µ–≥–∏

5. **–°–æ–∑–¥–∞—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤:**
   - CSV —Ñ–∞–π–ª —Å —Ç–∏–ø–æ–≤—ã–º–∏ OJS URL ‚Üí –Ω–æ–≤—ã–µ URL
   - –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

6. **–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã:**
   - –¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π
   - –¢–µ—Å—Ç—ã –¥–ª—è URLs –∏ views
   - –¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
   - –¢–µ—Å—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞

7. **–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ ETL –ø—Ä–æ—Ü–µ—Å—Å—É
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–∏–≥—Ä–∞—Ü–∏–∏:** –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
2. **Postgres:** GIN –∏–Ω–¥–µ–∫—Å—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `pg_trgm` –≤ Postgres
3. **–ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `media/jhdkz/<type>/<year>/<id-or-slug>/<filename>` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞—Ö —Ñ–∞–π–ª–æ–≤
4. **–ê–¥–º–∏–Ω–∫–∞:** –ù—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `jhdkz_portal/settings/base.py` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `jhdkz_portal/settings/dev.py` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `jhdkz_portal/settings/prod.py` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `.env.example` (—Å–æ–∑–¥–∞–Ω)
- `articles/models_extended.py`
- `core/models_extended.py`
- `core/middleware.py`
- `etl/__init__.py`
- `etl/util.py`
- `etl/normalize.py`
- `etl/crawler.py`
- `etl/cli.py`
- `etl/__main__.py`
- `articles/management/commands/import_jhd.py`
- `Makefile` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `PROGRESS.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `issues/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω slug, –∏–Ω–¥–µ–∫—Å—ã
- `articles/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω slug, section, –∏–Ω–¥–µ–∫—Å—ã
- `core/models.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å Redirect
- `articles/urls.py` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ slug
- `jhdkz_portal/settings/base.py` - –¥–æ–±–∞–≤–ª–µ–Ω middleware

